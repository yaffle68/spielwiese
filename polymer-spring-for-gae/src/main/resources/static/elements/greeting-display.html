<!-- <link rel='import' href='js/bower_components/polymer/polymer.html'></link> -->

<link rel="import" href="../js/bower_components/polymer/polymer.html">

<!-- <link rel="import" -->
<!-- 	href="https://polygit2.appspot.com/components/polymer/polymer.html"> -->
<link rel="import"
      href="../js/bower_components/iron-ajax/iron-ajax.html">
<link rel="import"
      href="../js/bower_components/paper-icon-button/paper-icon-button.html">
<link rel="import"
      href="../js/bower_components/iron-icons/maps-icons.html">
<link rel="import" href="../js/bower_components/iron-list/iron-list.html">

<link rel="import" href="../js/bower_components/iron-icon/iron-icon.html">
<link rel="import"
      href="../js/bower_components/iron-iconset-svg/iron-iconset-svg.html">

<link rel="import"
      href="../js/bower_components/iron-flex-layout/iron-flex-layout.html">

<link rel="import"
      href="../js/bower_components/iron-data-table/iron-data-table.html">


<dom-module id="greeting-display">
    <template>


        <style include="iron-flex iron-flex-alignment">
div.bubble {
	margin: 20px;
	padding: 20px;
	border-radius: 20px;
	background-color: #eee;
}

        </style>

        <iron-iconset-svg size="24" name="myicons">
            <svg>
                <defs>
                    <g id="system-update-alt">
                        <path d="M12 16.5l4-4h-3v-9h-2v9H8l4 4zm9-13h-6v1.99h6v14.03H3V5.49h6V3.5H3c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h18c1.1 0 2-.9 2-2v-14c0-1.1-.9-2-2-2z"></path>
                    </g>
                </defs>
            </svg>
        </iron-iconset-svg>


        <iron-ajax id="myworker" auto url="../resource"
                   handle-as="json" on-response="handleResponse" debounce-duration="300">
        </iron-ajax>

        <!--<iron-ajax id="stockpricefetcher" auto url="../stockprices"-->
        <!--handle-as="json" on-response="handleResponseStockPrices" debounce-duration="300">-->
        <!--</iron-ajax>-->

        <iron-ajax id="stockpricefetcher" url="../stockprices" last-response="{{data}}" auto></iron-ajax>


        <div class="bubble horizontal wrap">
            <h1>Stock Prices</h1>
            <p>The ID is {{greetingid}}</p>
            <p>The content is {{greetingcontent}}</p>
            <p>
                <paper-icon-button icon="myicons:system-update-alt" on-click="reload">Refresh</paper-icon-button>
                Refresh
            </p>


            <!--           <p>StockPrices as iron-list:</p>
                       <div>
                           <iron-list items="[[data]]" as="item">
                               <template>
                                   <div class="horizontal wrap">
                                       <span>
                                           Symbol: [[item.symbol]]
                                       </span>
                                       <span>
                                           Price: [[item.price]]
                                       </span>
                                       <span>
                                           Change: [[item.change]]
                                       </span>
                                   </div>
                               </template>
                           </iron-list>
                       </div>
                       -->

            <p>StockPrices as iron-data-table:</p>
            <div>
                <iron-data-table items="[[data]]" as="item">
                    <data-table-column name="Symbol">
                        <template>[[item.symbol]]</template>
                    </data-table-column>
                    <data-table-column name="Price">
                        <template>[[item.price]]</template>
                    </data-table-column>
                    <data-table-column name="Change">
                        <template>[[item.change]]</template>
                    </data-table-column>
                </iron-data-table>
            </div>


            <p>
                <paper-icon-button icon="myicons:system-update-alt" on-click="loadStockPrices">Load Stock Prices
                </paper-icon-button>
                Reload Stock Prices
            </p>

<!--
            <p>StockPrices as dom-repeat:</p>
            <template is="dom-repeat" items="{{data}}">
                <div class="horizontal wrap">
                    <span>Symbol: {{item.symbol}}</span>
                    <span>Price: {{item.price}}</span>
                </div>
            </template>
-->
        </div>

    </template>


    </div>
    </template>
    <script>
	// register a new element called proto-element
	Polymer({
		is : 'greeting-display',
		properties : {
			greetingid : String,
			greetingcontent : String,
			stockPrices : Array
		},

		ready : function() {
		    console.info("called ready");
		    this.stockPrices = ["initial"];
			this.$.myworker.generateRequest();
		},

		handleResponse : function(data) {
			this.greetingid = data.detail.response.id;
			this.greetingcontent = data.detail.response.content;
		},

		handleResponseStockPrices : function(data) {
		    var theData = {

		    };
		     console.info("Stock Prices: " + data.detail.response);
		     console.info("Stock Prices: " + typeof data.detail.response[0].symbol);
		     this.stockPrices = theData;
		},

		reload : function() {
			this.$.myworker.generateRequest();
		},

		loadStockPrices : function() {
		    console.info("called loadStockPrices");
		    this.$.stockpricefetcher.generateRequest();
		}
	});









    </script>
</dom-module>






